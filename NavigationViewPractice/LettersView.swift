//
//  LettersView.swift
//  NavigationViewPractice
//
//  Created by 曲奕帆 on 2021/3/23.
//

import SwiftUI

struct LettersView: View{
    
    
//    var letters: [Letter] = [
//        letter(id: 1, date: "2021.3.21", title: "時代性議題(六)慎選網路資訊", pastor:"毛廉翔傳道", content:"「耶穌對他們說：『你們要謹慎，防備法利賽人和撒都該人的酵。』」（太16:6）\n\n 「門徒這才曉得他說的不是叫他們防備餅的酵，乃是防備法利賽人和撒都該人的教訓。」（太16:12）\n\n 當主耶穌在世上的時候，法利賽人和撒都該人是當時猶太人社會宗教上的「主要教導」，對百姓有莫大的影響力。但是我們讀四福音時，屢次看見他們常常用「似是而非」的真理在誤導百姓，曲解上帝的真理，並且不時地跟主耶穌作對，破壞福音的傳遞。主耶穌特別交代門徒們提防他們的「酵」，也就是「思想」上的影響，因為一點酵，可以使得整團麵發起來，同樣的，一點錯誤的教訓，也有可能影響到整體導致全面性的偏差。2010年有一部很有名的電影叫「全面啟動Inception」，內容即在講描述思想的發酵，盜夢者對個案種下一個錯誤的核心信念，卻可以使得該對象的人生帶來毀滅，改變整個人。\n\n 而現代的我們，佔據「主要教導」的位置的，不正是我們每天朝夕相處的「網路」嗎？網路是個跨時代的偉大發明，特別在疫情時代，因著要保持距離的關係，網路更是產生前所未有的便利性，然而，網路上也充斥著「似是而非」的事情在混淆視聽，對人們投入「酵」。前一陣子就有人假冒疫情指揮中心投入了過度危言聳聽的「長輩圖」，讓長輩們流行在LINE群組之間不斷分享，假消息也不斷地傳出去，使得人心惶惶，最後政府不得不匡正視聽。對現今年輕人影響力極大的，當紅的「Youtuber」，在網路上開創了新模式，讓人看到「自媒體」的強大威力，許多Youtuber在創業的過程中所付出的努力也值得令人敬佩。然而在許多開箱文、開箱影片的背後，卻有著過度推崇「物質主義」、「享樂主義」等思想，並且也有人刻意挑選主題是遊走在道德邊緣，藉此吸引觀看數。上述所提的，只是網路亂象的冰山一角，更多光怪陸離的事情，早已屢見不鮮。\n\n 「我兒，要謹守真智慧和謀略，不可使他離開你的眼目。」（箴3:21）在這個世代，如何提防網路所帶來不好的「酵」，我認為是這世代所有的基督徒都應該優先學習的功課，求聖靈常與我們同在，定睛在主的真理上，有智慧使用網路，也有能力抵擋慎選網路資訊。"),
//        letter(id: 2, date: "2021.3.14", title: "人能把我怎麼樣呢？！", pastor:"錢黛芙牧師", content:"〈詩篇〉中多處說到這句話「人能把我怎麼樣呢？」〈詩篇56：4〉：「我倚靠神，我要讚美他的話；我倚靠神，必不懼怕。血氣之輩能把我怎麼樣呢？」〈詩篇118：6〉：「有耶和華幫助我，我必不懼怕，人能把我怎麼樣呢？」〈約翰福音二23〉也記載：「當耶穌在耶路撒冷過逾越節的時候，有許多人看見他所行的神蹟，就信了他的名。耶穌卻不將自己交託他們；因為他知道萬人。」耶穌不將自己交託他們，交託那些因見他所行神蹟而信祂的人。意思是，耶穌沒有受這些信祂的人，也就是今天流行的術語，受這些「耶粉」的影響，因為他沒有把自己交託他們。\n\n 乍看之下，「人能把我怎麼樣呢？」似乎予人一種我行我素的放任態度，然而回到〈詩篇〉的敘述，原意剛好相反。作者是在害怕中，害怕人，害怕血氣之輩，會加諸與自己的種種，而前來倚靠神，仰望神的幫助，他標榜的不是人能把我怎麼樣呢？不是因為他自己多行，以致人能把他怎麼樣呢？他標榜的是神，因為他倚靠的是神，他是把自己交託給神，在神的護蔭之下，他能自豪勇敢的說：「人能把我怎麼樣呢？」也是因為，神在他裡面給他的釋放自由，他可以不在意人對他的好與不好，不再受制於人的眼光，所以他說「人能把我怎麼樣呢？」我們若是把自己交託神，而不是交託人，人對我們的褒貶毀譽，也就不能把我們怎麼樣了。\n\n 然而這談何容易呢？我們如何活在人群中，卻不受人眼光的影響？我們經常有的困境，是自己把自己給怎麼樣了。可能環境、他人，卻還不是真正困難的核心，真正的困難還是在我們的心！耶穌不把自己交託眾人，祂把自己交託神。在神裡面，我們才能不受制於人。「人能把我們怎麼樣呢！」這既不是我行我素驕傲自大的態度，也不是自暴自棄式的灑脫，而是有神在我裡面定奪一切的自在。把自己交託神，使我們平衡，平衡使我們不致跌倒，不會在人對我們好或不好的環境下，錯亂了自己的方向和腳步。\n\n 「人能把我怎麼樣呢？」因為我將自己交託神，願神憐憫我們，相信這也是神的美意，祂要我們學這些功課，所以把我們放在錯綜複雜的人和環境裡，祂自己是這樣走過，也必能帶領我們。把自己交託給祂何其穩妥！"),
//        letter(id: 3, date: "2021.2.28", title: "時代性議題(五)高齡化社會", pastor:"毛廉翔傳道", content:""),
//        letter(id: 4, date: "2021.2.21", title: "成為滿有生命力的屬靈沃土", pastor:"黃主用牧師", content:""),
//        letter(id: 5, date: "2021.2.7", title: "罪與恩", pastor:"錢黛芙牧師", content:""),
//        letter(id: 6, date: "2021.1.24", title: "時代性議題(四)無接觸時代", pastor:"毛廉翔傳道", content:""),
//        letter(id: 7, date: "2021.1.10", title: "你有什麼不是領受的呢？", pastor:"錢黛芙牧師", content:"")
//    ]
    
    @State var httpResults = [Letter]()
    
    var body: some View{
        
        List(httpResults){ singleLetter in
            
            NavigationLink(destination: letterView(letterData: singleLetter)){
                Image(singleLetter.pastor)
                    .resizable()
                    .frame(width:45, height:45)
                    .clipShape(Circle())
                
                VStack(alignment: .leading, spacing: 2){
                    Text(singleLetter.title)
                        .font(.headline)
                    Text(singleLetter.pastor)
                        .font(.subheadline)
                    Text(singleLetter.date)
                        .font(.subheadline)
                        .foregroundColor(.gray)
                }
            }
            .padding(.vertical, 3)
        }
        .navigationTitle("景浸家書")
        .onAppear(perform: loadData)
    }
    
    func loadData(){
        guard let url = URL(string: "https://cmbc.herokuapp.com/jsonResponse/letters/") else{
            print("Invalid URL")
            return
        }
        let request = URLRequest(url: url)
        URLSession.shared.dataTask(with: request){ data, response, error in
            if let data = data {
                
                if let decodedResponse = try? JSONDecoder().decode(LetterResponse.self, from: data){
                    DispatchQueue.main.async{
                        //self.results = decodedResponse.results
                        self.httpResults = decodedResponse.results
                    }
                    return
                }
            }
            print("Fetch failed: \(error?.localizedDescription ?? "Unknown error")")
        }.resume()
    }
}

struct LetterResponse: Decodable{
    var results: [Letter]
}

struct Letter: Identifiable, Decodable{
    var id: Int
    var date: String
    var title: String
    var pastor: String
    var content: String
}

struct letterView: View{
    var letterData: Letter
    //var test: String
    
    var body: some View{
        
        ScrollView{
            VStack(alignment: .leading, spacing: 10){
                Text(letterData.title)
                    .font(.title)
                Text(letterData.pastor)
                    .font(.title3)
                Text(letterData.date)
                    .font(.headline)
                    .foregroundColor(.gray)
                
                Divider()
                Text(letterData.content)
                    .font(.title3)
            }.frame(alignment: .leading)
            .padding()
        }.navigationBarTitle("", displayMode: .inline)
    }
}
